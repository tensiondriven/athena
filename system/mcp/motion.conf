# Motion Detection Configuration
# Optimized for Raspberry Pi with USB camera and MQTT integration

############################################################
# Daemon Configuration
############################################################

# Start in daemon (background) mode and release terminal
daemon off

# File to store the process ID
process_id_file /var/run/motion/motion.pid

############################################################
# Basic Setup
############################################################

# Start motion in setup mode
setup_mode off

# Use a file to save logs messages, if not defined stderr and syslog is used
log_file /var/log/motion/motion.log

# Level of log messages [1..9] (EMG, ALR, CRT, ERR, WRN, NTC, INF, DBG, ALL)
log_level 6

# Filter to log messages by type (COR, STR, ENC, NET, DBL, EVT, TRK, VID, ALL)
log_type all

############################################################
# Capture device options
############################################################

# Videodevice to be used for capturing
videodevice /dev/video0

# Image input format (raw, v4l2_palette)
vid_control_params auto_gain=0,gain=64,brightness=32,contrast=32,saturation=32

# Video capturing format (mjpeg, yuv420p, rgb24)
v4l2_palette yuv420p

# Video input controls
input -1

# Video capture frame rate (fps)
framerate 15

############################################################
# Image Processing
############################################################

# Image width and height
width 640
height 480

# Rotate image this number of degrees
rotate 0

# Output 'normal' pictures when motion is detected
output_pictures on

# Output pictures with only the pixels moving object (ghost images)
output_debug_pictures off

# Quality of the jpeg (in percent) for normal pictures
quality 75

# Type of output images (jpg, png, webp)
picture_type jpg

############################################################
# Motion Detection Settings
############################################################

# Threshold for number of changed pixels in an image that triggers motion detection
threshold 1500

# Noise threshold for the motion detection
noise_level 32

# Automatically tune the threshold down if possible
threshold_tune off

# Picture frames must contain motion at least the specified number of frames
minimum_motion_frames 1

# Specifies the number of pre-captured (buffered) pictures from before motion was detected
pre_capture 3

# Number of frames to capture after motion is no longer detected
post_capture 0

# Gap is the seconds of no motion detection that triggers the end of an event
event_gap 60

# Maximum length in seconds of a movie
max_movie_time 0

# Use ffmpeg to encode movies
ffmpeg_output_movies on

# Use ffmpeg to make tmelapse movies
ffmpeg_timelapse 0

# Quality of the movie (0-100, 0 means use bitrate)
movie_quality 60

# Output movie format (mp4, avi, mov, mkv, ogg, webm)
movie_codec mp4

############################################################
# Snapshots (Traditional Periodic Webcam File Output)
############################################################

# Make automated snapshot every N seconds (0 = disabled)
snapshot_interval 0

############################################################
# Web Control Configuration
############################################################

# Port number for the web server to listen on
webcontrol_port 8080

# Restrict web control connections to localhost only
webcontrol_localhost off

# Output for http server (for streaming)
stream_port 8081

# Quality of the jpeg (in percent) for streaming
stream_quality 50

# Maximum framerate of the stream (fps)
stream_maxrate 5

# Restrict stream connections to localhost only  
stream_localhost off

# Limits the number of images per connection
stream_limit 0

############################################################
# File and Directory Configuration
############################################################

# Target base directory for pictures and films
target_dir /var/lib/motion

# File path for pictures (jpeg) relative to target_dir
picture_filename %Y%m%d_%H%M%S-%q

# File path for movies relative to target_dir
movie_filename %Y%m%d_%H%M%S

# Command to execute when an event starts
on_event_start /scripts/motion_notify.py motion_start

# Command to execute when an event ends
on_event_end /scripts/motion_notify.py motion_end %f

# Command to execute when a picture is saved
on_picture_save /scripts/motion_notify.py picture_saved %f

# Command to execute when a movie is saved
on_movie_end /scripts/motion_notify.py movie_saved %f

############################################################
# Security and Access
############################################################

# Username and password for web interface (optional)
# webcontrol_authentication username:password

############################################################
# Camera specific configuration
############################################################

# The mini-http server listens to this port for requests
stream_auth_method 0

# Authentication for the stream
# stream_authentication username:password

############################################################
# Database and Logging Options
############################################################

# Log level for outputting to syslog
syslog_level 6

# Create a pid file
pid_file /var/run/motion/motion.pid

############################################################
# Optimization for Raspberry Pi
############################################################

# Reduce CPU usage by lowering quality when no motion
quiet on

# Despeckle motion image using (e)rode or (d)ilate or (l)abel
despeckle_filter EedDl

# Number of images that must contain motion to trigger an event
threshold_maximum 0

# Enable/disable automatic brightness adjustment
auto_brightness off

# Ignore sudden massive light changes
lightswitch_percent 0

# Picture with most motion of an event saved when set to 'best'
locate_motion_mode off

# Set the look and style of the locate box if enabled
locate_motion_style box

# Draws the timestamp using same options as C function strftime(3)
text_left CAMERA: %{host}

# Draw a timestamp in the top right corner of the picture
text_right %Y-%m-%d\n%T-%q

# Text is written in double sized characters
text_double off

# Text is written in white on black background
text_changes off

############################################################
# Advanced Options
############################################################

# Maximum number of frames to be captured per second
frequency 0

# Always save a snapshot when motion is detected
snapshot_interval 0

# Enable/disable putting an event file on disk
movie_output on

# Use ffmpeg to encode movies in realtime
movie_output_motion off

# Maximum number of movie files in target_dir before old ones are deleted
movie_max_files 50

# Maximum number of picture files in target_dir before old ones are deleted  
picture_max_files 100

############################################################
# Thread Configuration
############################################################

# Number of motion detection threads (0 = auto)
thread /dev/video0